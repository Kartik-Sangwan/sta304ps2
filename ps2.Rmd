---
title: "Informative title"
author: "Name"
date: "Date"
abstract: "Four sentences"
output: html_document
---

```{r setup, include=FALSE}
set.seed(1001)
knitr::opts_chunk$set(echo = TRUE)
# install.packages("tidyverse")
install.packages("remotes")
remotes::install_github("hodgettsp/cesR")
library(tidyverse)
library(visdat)
library(cesR)
library(skimr)
```

# Introduction

Three paragraph statement.

First paragraph: General. Motivational. Majors specific finding. 

Second paragraph: More about what you did and found.

Third paragraph: Outline of the paper. Future work. Weaknesses.


```{r download, warning=FALSE, message=FALSE}
cesR::get_decon()
total <- 37822
age <- decon %>% select("yob") %>% mutate(age = 2020 - as.numeric(as.character(yob)))
age_cat <- age %>% mutate(age_group = case_when(age >= 18 & age <= 30 ~ 1, age >= 31 & age <= 40 ~ 2, age >= 41 & age <= 50 ~ 3, age >= 51 & age <= 60 ~ 4, age >= 61 & age <= 70 ~ 5, age>=71 ~ 6))
gender_weights <- decon %>% count(gender)
province_weights <- decon %>% count(province_territory)
education_weights <- decon %>% count(education)
education_weights <- c(522, 7514, 12096, 12908, 4782)
income_cat_weights <- decon %>% count(income_cat) %>% add_row("income_cat" = "prefer not to answer", n = 28453)
income_cat_weights <- income_cat_weights[-c(9, 10),]
age_group_weights <- age_cat %>% count(age_group)
# fix this later
first_time_voter_weight <- c(ceiling(0.2*total), ceiling(0.8*total) - 1)
decided_to_vote <- c(29346, 8476)
# fake improve later on
ethnicity <- c(ceiling(0.05*total)-1, ceiling(0.12*total)-1, ceiling(0.04*total)-1, ceiling(0.26*total), ceiling(0.34*total), ceiling(0.09*total), ceiling(0.1*total))
# from wikipedia
last_election_vote <- data.frame(party = c("The Liberal Party of Canada", "The Conservative Party of Canada", "The Green Party of Canada", "New Democratic Party (NDP)", "Bloc Québécois", "People's Party of Canada (PPC)", "I voted for an independent politician", "None of the above"), votes = c(ceiling(0.45*total)-1, ceiling(0.35*total)-1, ceiling(0.009*total)-1, ceiling(0.07*total), ceiling(0.09*total), ceiling(0.01*total), ceiling(0.01*total)-1, ceiling(0.011*total)))

temp <- rnorm(8, 0, 2)
preference_weights <- c(0.36, 0.24, 0.1, 0.08, 0.02, 0.16, 0.02, 0.02)

# convert rep to SRS
# creating the dataset from our survey using real world parameters and cesR data
survey_responses <- data.frame(gender = sample(c("Male", "Female", "LGBTQ"), total, replace = TRUE, prob = gender_weights$n), 
                               age = sample(c("18-30", "31-40", "41-50", "51-60", "61-70", "71+"), total, TRUE,age_group_weights$n), 
                               first_time_vote = sample(c("YES", "NO"),total, TRUE, first_time_voter_weight),
                               decided_to_vote = sample(c("YES", "NO"),total,TRUE, decided_to_vote),
                               education = sample(c("None", "High School", "College/Diploma", "University (Bachelor's Degree)", "University (Master's/PhD)"),total,TRUE, education_weights),
                               salary = sample(c("No income", "$1 to $30,000", "	$30,001 to $60,000", "$60,001 to $90,000", "$90,001 to $110,000", "$110,001 to $150,000", "$150,001 to $200,000", "More than $200,000", "Don't know/ Prefer not to answer"),total, TRUE, income_cat_weights$n),
                               province = sample(c("Alberta", "British Columbia", "Manitoba", "New Brunswick", "Newfoundland and Labrador" , "Northwest Territories", "Nova Scotia", "Nunavut", "Ontario", "Prince Edward Island", "Quebec", "Saskatchewan", "Yukon"),total, TRUE, province_weights$n),
                               last_election_vote = sample( c("The Liberal Party of Canada", "The Conservative Party of Canada", "The Green Party of Canada", "New Democratic Party (NDP)", "Bloc Québécois", "People's Party of Canada (PPC)", "I voted for an independent politician", "None of the above"),total,TRUE, last_election_vote$votes),
                               ethnicity = sample(c("Caucasian", "African", "Hispanic or Latino", "East Asian", "South Asian", "I am one of the Indigenous Peoples of Canada", "Other"), total, TRUE, ethnicity),
                               current_preference = sample(c("The Liberal Party of Canada", "The Conservative Party of Canada", "The Green Party of Canada", "New Democratic Party (NDP)", "Bloc Québécois", "People's Party of Canada (PPC)", "I voted for an independent politician", "None of the above"),total,TRUE, preference_weights)
                               )

# JUST NEED TO FIGURE OUR THE WEIGHTS FOR THE UPCOMING ELECTINOS WHICH IS THE MAIN ONE
# shuffling the rows 
survey_data <- survey_responses[sample(nrow(survey_responses)),]
survey_data <- survey_data %>% mutate(id = row_number())
head(survey_data)

# We can do some raw population data exploration like population paramters shaped of graphs e.t.c

# stratifying according to the provinces
# first arranging the data by provinces

survey_data <- arrange(survey_data, province)
# Store the row number where each of the provinces last entry is. This corresponds to one strats. 
last_rows <- survey_data %>% arrange(province) %>% group_by(province) %>% summarise_all(last)

provinces_row_numbers <- data.frame(province = c("Alberta", "British Columbia", "Manitoba", "New Brunswick", "Newfoundland and Labrador" , "Northwest Territories", "Nova Scotia", "Nunavut", "Ontario", "Prince Edward Island", "Quebec", "Saskatchewan", "Yukon"), row_num = last_rows$id)

# doing simple random sampling in each of the 13 strata 
i <- 0
# total number of stratified SRS
required <- 3000
parties <- c("The Liberal Party of Canada", "The Conservative Party of Canada", "The Green Party of Canada", "New Democratic Party (NDP)", "Bloc Québécois", "People's Party of Canada (PPC)", "I voted for an independent politician", "None of the above")

result1 <- matrix(NA, nrow = 13, ncol = 8, dimnames = list(provinces_row_numbers$province,parties))
res <- data.frame(Alberta = "", BritishColumbia = "" ,Manitoba = "",NewBrunswick="", NewfoundlandandLabrador = "", NorthwestTerritories = "", NovaScotia = "", Nunavut= "", Ontario = "", PrinceEdwardIsland = "", Quebec="", Saskatchewan="", Yukon="")

# taking a simple random sample 10 times for the stratas
# we have used proportional allocation method using CES dataset as the population
#for (j in 1:5){
  print(paste("sample number:", j))
  i <- 0
  p <- 1
  for (ind in provinces_row_numbers$row_num){
    print(paste("new strata for:", provinces_row_numbers$province[p]))
    prop = (ind - i)/total
    print(prop)
    rows <- sample_n(survey_data[i:ind,], ceiling(prop*required))
    result <- rows %>% count(current_preference)
    print(result)
    i = ind
    p <- p + 1
  }
  
#}


```

# Data

The CES dataset is....

```{r}
head(decon)
```
Some initial explorations that would be used to guide this section.

```{r}
visdat::vis_dat(decon)

skimr::skim(decon)

class(decon$ces_code)

decon <- 
  decon %>% 
  filter(income < 1000000)

decon <- 
  decon %>% 
  select(religion, income)
```


The variables we focus on are....

Summary statistics for these variables...

You must include graphs.


```{r}
decon %>% 
  ggplot(aes(x = religion)) +
  geom_bar()
```


```{r}
decon %>% 
  ggplot(aes(x = income)) +
  geom_histogram()
```



```{r}
decon %>% 
  ggplot(aes(x = income)) +
  geom_histogram() +
  labs(x = "Income",
       y = "Number",
       title = "Distribution of income in 2019 CES",
       caption = "Source: Stephenson, Harell, Rubenson, Loewen, 2020.") +
  theme_bw()
```

In this graph we find that the distribution of income is heavily skewed....




# Discussion

My discussion... main findings of your graph.


Features of your survey.... Non-response... etc. And how these could affect the results....




## Weaknesses and next steps

My weaknesses...






# References

- Stephenson, Laura B; Harell, Allison; Rubenson, Daniel; Loewen, Peter John, 2020, '2019 Canadian Election Study - Online Survey', https://doi.org/10.7910/DVN/DUS88V, Harvard Dataverse, V1
- Paul A. Hodgetts and Rohan Alexander (2020). cesR: Access the CES Datasets a Little Easier.. R package version 0.1.0.
-  Hadley Wickham, Jim Hester and Winston Chang (2020). devtools: Tools to Make Developing R Packages Easier. https://devtools.r-lib.org/,https://github.com/r-lib/devtools.
- R Core Team (2020). R: A language and environment for statistical computing. R, Foundation for Statistical Computing, Vienna, Austria. URL, https://www.R-project.org/.
- JJ Allaire and Yihui Xie and Jonathan McPherson and Javier Luraschi and Kevin Ushey and Aron Atkins and Hadley Wickham and Joe Cheng and Winston Chang and Richard Iannone (2020). rmarkdown: Dynamic Documents for R. R package version 2.3. URL https://rmarkdown.rstudio.com.




